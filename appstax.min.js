!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.appstax=e()}}(function(){var define,module,exports;return function e(t,n,r){function o(s,a){if(!n[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(i)return i(s,!0);throw new Error("Cannot find module '"+s+"'")}var c=n[s]={exports:{}};t[s][0].call(c.exports,function(e){var n=t[s][1][e];return o(n?n:e)},c,c.exports,e,t,n,r)}return n[s].exports}for(var i="function"==typeof require&&require,s=0;s<r.length;s++)o(r[s]);return o}({1:[function(e,t){var n,r=Object.prototype.hasOwnProperty,o=Object.prototype.toString,i=function(e){"use strict";if(!e||"[object Object]"!==o.call(e)||e.nodeType||e.setInterval)return!1;var t=r.call(e,"constructor"),i=e.constructor&&e.constructor.prototype&&r.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!i)return!1;var s;for(s in e);return s===n||r.call(e,s)};t.exports=function s(){"use strict";var e,t,r,o,a,u,c=arguments[0],l=1,f=arguments.length,p=!1;for("boolean"==typeof c?(p=c,c=arguments[1]||{},l=2):("object"!=typeof c&&"function"!=typeof c||c==n)&&(c={});f>l;++l)if(null!=(e=arguments[l]))for(t in e)r=c[t],o=e[t],c!==o&&(p&&o&&(i(o)||(a=Array.isArray(o)))?(a?(a=!1,u=r&&Array.isArray(r)?r:[]):u=r&&i(r)?r:{},c[t]=s(p,u,o)):o!==n&&(c[t]=o));return c}},{}],2:[function(){},{}],3:[function(e,t){function n(){}var r=t.exports={};r.nextTick=function(){var e="undefined"!=typeof window&&window.setImmediate,t="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(e)return function(e){return window.setImmediate(e)};if(t){var n=[];return window.addEventListener("message",function(e){var t=e.source;if((t===window||null===t)&&"process-tick"===e.data&&(e.stopPropagation(),n.length>0)){var r=n.shift();r()}},!0),function(e){n.push(e),window.postMessage("process-tick","*")}}return function(e){setTimeout(e,0)}}(),r.title="browser",r.browser=!0,r.env={},r.argv=[],r.on=n,r.addListener=n,r.once=n,r.off=n,r.removeListener=n,r.removeAllListeners=n,r.emit=n,r.binding=function(){throw new Error("process.binding is not supported")},r.cwd=function(){return"/"},r.chdir=function(){throw new Error("process.chdir is not supported")}},{}],4:[function(e,t){(function(e){function n(e,t){this.promise=this,this._isPromise=!0,this._successFn=e,this._failFn=t,this._scope=this,this._boundArgs=null,this._hasContext=!1,this._nextContext=void 0,this._currentContext=void 0}function r(e,t,n){t?e.reject(t):e.resolve(n)}function o(e){return!!e._isPromise}function i(e){return"object"==typeof e&&"function"==typeof e.then}function s(e){var t=new n;return t.resolve(e),t}function a(e){var t=new n;return t.reject(e),t}function u(e,t,n){return e[t]=n,n}function c(e,t,n){return e[t]={state:"fulfilled",value:n},n}function l(e,t,n){return e[t]={state:"rejected",reason:n},n}function f(e){if(1==arguments.length&&Array.isArray(e)||(e=Array.prototype.slice.call(arguments,0)),!e.length)return s([]);for(var t=[],r=!1,o=new n,a=e.length,c=0;c<e.length;c+=1)e[c]&&i(e[c])?e[c].then(u.bind(null,t,c)).then(function(){a--,r||0!==a||(r=!0,o.resolve(t))},function(e){r||(r=!0,o.reject(e))}):(t[c]=e[c],a-=1);return 0!==a||r||(r=!0,o.resolve(t)),o}function p(e){if(!Array.isArray(e))throw Error('The input to "allSettled()" should be an array of Promise or values');if(!e.length)return s([]);for(var t=[],r=new n,o=e.length,a=0;a<e.length;a+=1)e[a]&&i(e[a])?e[a].then(c.bind(null,t,a),l.bind(null,t,a)).then(function(){0===--o&&r.resolve(t)}):(c(t,a,e[a]),0===--o&&r.resolve(t));return r}function d(){return new n}function h(e,t){var r=void 0,o=e;if("undefined"!=typeof t&&(o=t,r=e),"number"!=typeof o)throw new Error("Bad delay value "+o);var i=new n;return setTimeout(function(){i.resolve(r)},o),i}function y(t){var r=Array.prototype.slice.call(arguments,1),o=new n;return e.nextTick(function(){try{o.resolve(t.apply(void 0,r))}catch(e){o.reject(e)}}),o}function m(){var e=Array.prototype.slice.call(arguments,0);return e.splice(1,0,void 0),v.apply(void 0,e)()}function v(e,t){var r=Array.prototype.slice.call(arguments,2);return function(){var o=new n;try{e.apply(t,r.concat(Array.prototype.slice.call(arguments,0),o.makeNodeResolver()))}catch(i){o.reject(i)}return o}}n.prototype._useContext=function(e){return this._nextContext=this._currentContext=e,this._hasContext=!0,this},n.prototype.clearContext=function(){return this._hasContext=!1,this._nextContext=void 0,this},n.prototype.setContext=function(e){return this._nextContext=e,this._hasContext=!0,this},n.prototype.getContext=function(){return this._nextContext},n.prototype.resolve=function(e){if(this._error||this._hasData)throw new Error("Unable to resolve or reject the same promise twice");var t;if(e&&o(e)){if(this._child=e,this._promises){for(t=0;t<this._promises.length;t+=1)e._chainPromise(this._promises[t]);delete this._promises}if(this._onComplete){for(t=0;t<this._onComplete.length;t+=1)e.fin(this._onComplete[t]);delete this._onComplete}}else if(e&&i(e))e.then(function(e){this.resolve(e)}.bind(this),function(e){this.reject(e)}.bind(this));else{if(this._hasData=!0,this._data=e,this._onComplete)for(t=0;t<this._onComplete.length;t++)this._onComplete[t]();if(this._promises){for(t=0;t<this._promises.length;t+=1)this._promises[t]._withInput(e);delete this._promises}}},n.prototype.reject=function(t){if(this._error||this._hasData)throw new Error("Unable to resolve or reject the same promise twice");var n;if(this._error=t,this._ended&&e.nextTick(function(){throw t}),this._onComplete)for(n=0;n<this._onComplete.length;n++)this._onComplete[n]();if(this._promises){for(n=0;n<this._promises.length;n+=1)this._promises[n]._withError(t);delete this._promises}},n.prototype.then=function(e,t){var r=new n(e,t);return this._nextContext&&r._useContext(this._nextContext),this._child?this._child._chainPromise(r):this._chainPromise(r),r},n.prototype.thenBound=function(e,t){var r=new n(e);return this._nextContext&&r._useContext(this._nextContext),r._scope=t,arguments.length>2&&(r._boundArgs=Array.prototype.slice.call(arguments,2)),this._child?this._child._chainPromise(r):this._chainPromise(r),r},n.prototype.fail=function(e){return this.then(null,e)},n.prototype.failBound=function(e,t){var r=new n(null,e);return this._nextContext&&r._useContext(this._nextContext),r._scope=t,arguments.length>2&&(r._boundArgs=Array.prototype.slice.call(arguments,2)),this._child?this._child._chainPromise(r):this._chainPromise(r),r},n.prototype.fin=function(e){return this._hasData||this._error?(e(),this):(this._child?this._child.fin(e):this._onComplete?this._onComplete.push(e):this._onComplete=[e],this)},n.prototype.end=function(){return this._end(),this},n.prototype._end=function(){if(this._error)throw this._error;return this._ended=!0,this},n.prototype.done=function(e,t){var n=this;(e||t)&&(n=n.then(e,t)),n._end()},n.prototype.timeout=function(e,t){var r=new n,o=!1,i=setTimeout(function(){r.reject(new Error(t||"Promise timeout after "+e+" ms.")),o=!0},e);return this.then(function(e){o||(clearTimeout(i),r.resolve(e))},function(e){o||(clearTimeout(i),r.reject(e))}),r.promise},n.prototype._withInput=function(e){if(this._successFn)try{this.resolve(this._call(this._successFn,[e,this._currentContext]))}catch(t){this.reject(t)}else this.resolve(e);delete this._currentContext},n.prototype._withError=function(e){if(this._failFn)try{this.resolve(this._call(this._failFn,[e,this._currentContext]))}catch(t){this.reject(t)}else this.reject(e);delete this._currentContext},n.prototype._call=function(e,t){return this._boundArgs&&(t=this._boundArgs.concat(t)),e.apply(this._scope,t)},n.prototype._chainPromise=function(e){this._hasContext&&e._useContext(this._nextContext),this._child?this._child._chainPromise(e):this._hasData?e._withInput(this._data):this._error?e._withError(this._error):this._promises?this._promises.push(e):this._promises=[e]},n.prototype.makeNodeResolver=function(){return r.bind(null,this)},n.prototype.delay=function(e){return this.then(function(t){return h(t,e)})},t.exports={all:f,bindPromise:v,defer:d,delay:h,fcall:y,isPromise:o,isPromiseLike:i,nfcall:m,resolve:s,reject:a,allSettled:p,Promise:n}}).call(this,e("1YiZ5S"))},{"1YiZ5S":3}],5:[function(_dereq_,module,exports){!function(e,t,n){"undefined"!=typeof module&&module.exports?module.exports=n():"function"==typeof define&&define.amd?define(n):t[e]=n()}("reqwest",this,function(){function succeed(e){var t=protocolRe.exec(e.url);return t=t&&t[1]||context.location.protocol,httpsRe.test(t)?twoHundo.test(e.request.status):!!e.request.response}function handleReadyState(e,t,n){return function(){return e._aborted?n(e.request):e._timedOut?n(e.request,"Request is aborted: timeout"):void(e.request&&4==e.request[readyState]&&(e.request.onreadystatechange=noop,succeed(e)?t(e.request):n(e.request)))}}function setHeaders(e,t){var n,r=t.headers||{};r.Accept=r.Accept||defaultHeaders.accept[t.type]||defaultHeaders.accept["*"];var o="undefined"!=typeof FormData&&t.data instanceof FormData;t.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||o||(r[contentType]=t.contentType||defaultHeaders.contentType);for(n in r)r.hasOwnProperty(n)&&"setRequestHeader"in e&&e.setRequestHeader(n,r[n])}function setCredentials(e,t){"undefined"!=typeof t.withCredentials&&"undefined"!=typeof e.withCredentials&&(e.withCredentials=!!t.withCredentials)}function generalCallback(e){lastValue=e}function urlappend(e,t){return e+(/\?/.test(e)?"&":"?")+t}function handleJsonp(e,t,n,r){var o=uniqid++,i=e.jsonpCallback||"callback",s=e.jsonpCallbackName||reqwest.getcallbackPrefix(o),a=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),u=r.match(a),c=doc.createElement("script"),l=0,f=-1!==navigator.userAgent.indexOf("MSIE 10.0");return u?"?"===u[3]?r=r.replace(a,"$1="+s):s=u[3]:r=urlappend(r,i+"="+s),context[s]=generalCallback,c.type="text/javascript",c.src=r,c.async=!0,"undefined"==typeof c.onreadystatechange||f||(c.htmlFor=c.id="_reqwest_"+o),c.onload=c.onreadystatechange=function(){return c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||l?!1:(c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t(lastValue),lastValue=void 0,head.removeChild(c),void(l=1))},head.appendChild(c),{abort:function(){c.onload=c.onreadystatechange=null,n({},"Request is aborted: timeout",{}),lastValue=void 0,head.removeChild(c),l=1}}}function getRequest(e,t){var n,r=this.o,o=(r.method||"GET").toUpperCase(),i="string"==typeof r?r:r.url,s=r.processData!==!1&&r.data&&"string"!=typeof r.data?reqwest.toQueryString(r.data):r.data||null,a=!1;return"jsonp"!=r.type&&"GET"!=o||!s||(i=urlappend(i,s),s=null),"jsonp"==r.type?handleJsonp(r,e,t,i):(n=r.xhr&&r.xhr(r)||xhr(r),n.open(o,i,r.async===!1?!1:!0),setHeaders(n,r),setCredentials(n,r),context[xDomainRequest]&&n instanceof context[xDomainRequest]?(n.onload=e,n.onerror=t,n.onprogress=function(){},a=!0):n.onreadystatechange=handleReadyState(this,e,t),r.before&&r.before(n),a?setTimeout(function(){n.send(s)},200):n.send(s),n)}function Reqwest(e,t){this.o=e,this.fn=t,init.apply(this,arguments)}function setType(e){return null===e?void 0:e.match("json")?"json":e.match("javascript")?"js":e.match("text")?"html":e.match("xml")?"xml":void 0}function init(o,fn){function complete(e){for(o.timeout&&clearTimeout(self.timeout),self.timeout=null;self._completeHandlers.length>0;)self._completeHandlers.shift()(e)}function success(resp){var type=o.type||resp&&setType(resp.getResponseHeader("Content-Type"));resp="jsonp"!==type?self.request:resp;var filteredResponse=globalSetupOptions.dataFilter(resp.responseText,type),r=filteredResponse;try{resp.responseText=r}catch(e){}if(r)switch(type){case"json":try{resp=context.JSON?context.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r;break;case"xml":resp=resp.responseXML&&resp.responseXML.parseError&&resp.responseXML.parseError.errorCode&&resp.responseXML.parseError.reason?null:resp.responseXML}for(self._responseArgs.resp=resp,self._fulfilled=!0,fn(resp),self._successHandler(resp);self._fulfillmentHandlers.length>0;)resp=self._fulfillmentHandlers.shift()(resp);complete(resp)}function timedOut(){self._timedOut=!0,self.request.abort()}function error(e,t,n){for(e=self.request,self._responseArgs.resp=e,self._responseArgs.msg=t,self._responseArgs.t=n,self._erred=!0;self._errorHandlers.length>0;)self._errorHandlers.shift()(e,t,n);complete(e)}this.url="string"==typeof o?o:o.url,this.timeout=null,this._fulfilled=!1,this._successHandler=function(){},this._fulfillmentHandlers=[],this._errorHandlers=[],this._completeHandlers=[],this._erred=!1,this._responseArgs={};var self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){timedOut()},o.timeout)),o.success&&(this._successHandler=function(){o.success.apply(o,arguments)}),o.error&&this._errorHandlers.push(function(){o.error.apply(o,arguments)}),o.complete&&this._completeHandlers.push(function(){o.complete.apply(o,arguments)}),this.request=getRequest.call(this,success,error)}function reqwest(e,t){return new Reqwest(e,t)}function normalize(e){return e?e.replace(/\r?\n/g,"\r\n"):""}function serial(e,t){var n,r,o,i,s=e.name,a=e.tagName.toLowerCase(),u=function(e){e&&!e.disabled&&t(s,normalize(e.attributes.value&&e.attributes.value.specified?e.value:e.text))};if(!e.disabled&&s)switch(a){case"input":/reset|button|image|file/i.test(e.type)||(n=/checkbox/i.test(e.type),r=/radio/i.test(e.type),o=e.value,(!(n||r)||e.checked)&&t(s,normalize(n&&""===o?"on":o)));break;case"textarea":t(s,normalize(e.value));break;case"select":if("select-one"===e.type.toLowerCase())u(e.selectedIndex>=0?e.options[e.selectedIndex]:null);else for(i=0;e.length&&i<e.length;i++)e.options[i].selected&&u(e.options[i])}}function eachFormElement(){var e,t,n=this,r=function(e,t){var r,o,i;for(r=0;r<t.length;r++)for(i=e[byTag](t[r]),o=0;o<i.length;o++)serial(i[o],n)};for(t=0;t<arguments.length;t++)e=arguments[t],/input|select|textarea/i.test(e.tagName)&&serial(e,n),r(e,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var e={};return eachFormElement.apply(function(t,n){t in e?(e[t]&&!isArray(e[t])&&(e[t]=[e[t]]),e[t].push(n)):e[t]=n},arguments),e}function buildParams(e,t,n,r){var o,i,s,a=/\[\]$/;if(isArray(t))for(i=0;t&&i<t.length;i++)s=t[i],n||a.test(e)?r(e,s):buildParams(e+"["+("object"==typeof s?i:"")+"]",s,n,r);else if(t&&"[object Object]"===t.toString())for(o in t)buildParams(e+"["+o+"]",t[o],n,r);else r(e,t)}var context=this;if("window"in context)var doc=document,byTag="getElementsByTagName",head=doc[byTag]("head")[0];else{var XHR2;try{XHR2=_dereq_("xhr2")}catch(ex){throw new Error("Peer dependency `xhr2` required! Please npm install xhr2")}}var httpsRe=/^http/,protocolRe=/(^\w+):\/\//,twoHundo=/^(20\d|1223)$/,readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",uniqid=0,callbackPrefix="reqwest_"+ +new Date,lastValue,xmlHttpRequest="XMLHttpRequest",xDomainRequest="XDomainRequest",noop=function(){},isArray="function"==typeof Array.isArray?Array.isArray:function(e){return e instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",requestedWith:xmlHttpRequest,accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"}},xhr=function(e){if(e.crossOrigin===!0){var t=context[xmlHttpRequest]?new XMLHttpRequest:null;if(t&&"withCredentials"in t)return t;if(context[xDomainRequest])return new XDomainRequest;throw new Error("Browser does not support cross-origin requests")}return context[xmlHttpRequest]?new XMLHttpRequest:XHR2?new XHR2:new ActiveXObject("Microsoft.XMLHTTP")},globalSetupOptions={dataFilter:function(e){return e}};return Reqwest.prototype={abort:function(){this._aborted=!0,this.request.abort()},retry:function(){init.call(this,this.o,this.fn)},then:function(e,t){return e=e||function(){},t=t||function(){},this._fulfilled?this._responseArgs.resp=e(this._responseArgs.resp):this._erred?t(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):(this._fulfillmentHandlers.push(e),this._errorHandlers.push(t)),this},always:function(e){return this._fulfilled||this._erred?e(this._responseArgs.resp):this._completeHandlers.push(e),this},fail:function(e){return this._erred?e(this._responseArgs.resp,this._responseArgs.msg,this._responseArgs.t):this._errorHandlers.push(e),this},"catch":function(e){return this.fail(e)}},reqwest.serializeArray=function(){var e=[];return eachFormElement.apply(function(t,n){e.push({name:t,value:n})},arguments),e},reqwest.serialize=function(){if(0===arguments.length)return"";var e,t,n=Array.prototype.slice.call(arguments,0);return e=n.pop(),e&&e.nodeType&&n.push(e)&&(e=null),e&&(e=e.type),t="map"==e?serializeHash:"array"==e?reqwest.serializeArray:serializeQueryString,t.apply(null,n)},reqwest.toQueryString=function(e,t){var n,r,o=t||!1,i=[],s=encodeURIComponent,a=function(e,t){t="function"==typeof t?t():null==t?"":t,i[i.length]=s(e)+"="+s(t)};if(isArray(e))for(r=0;e&&r<e.length;r++)a(e[r].name,e[r].value);else for(n in e)e.hasOwnProperty(n)&&buildParams(n,e[n],o,a);return i.join("&").replace(/%20/g,"+")},reqwest.getcallbackPrefix=function(){return callbackPrefix},reqwest.compat=function(e,t){return e&&(e.type&&(e.method=e.type)&&delete e.type,e.dataType&&(e.type=e.dataType),e.jsonpCallback&&(e.jsonpCallbackName=e.jsonpCallback)&&delete e.jsonpCallback,e.jsonp&&(e.jsonpCallback=e.jsonp)),new Reqwest(e,t)},reqwest.ajaxSetup=function(e){e=e||{};for(var t in e)globalSetupOptions[t]=e[t]},reqwest})},{xhr2:2}],6:[function(e,t){function n(e,t){var n;return n=t?new o(e,t):new o(e)}var r=function(){return this}(),o=r.WebSocket||r.MozWebSocket;t.exports=o?n:null,o&&(n.prototype=o.prototype)},{}],7:[function(e,t){function n(e){function t(){g=r({},g,e),n();try{g.appKeyBase32=i.base32.encode(g.appKey)}catch(t){}}function n(){var e=g.baseUrl;"string"==typeof e&&e.lastIndexOf("/")!=e.length-1&&(g.baseUrl=e+"/")}function u(e,t,n){var r=e,o="";return 0==r.indexOf("/")&&(r=r.substr(1)),"object"==typeof t&&Object.keys(t).forEach(function(e){r=r.replace(":"+e,c(t[e]))}),"object"==typeof n&&(o=Object.keys(n).map(function(e){return e+"="+c(n[e])}).join("&")),""!=o&&(r+=(-1==r.indexOf("?")?"?":"&")+o),g.baseUrl+r}function c(e){return encodeURIComponent(e).replace(/'/g,"%27")}function l(e,t,n){var r={};r.url=t,r.method=e,r.contentType="application/json",r.headers=f(),r.processData=!0,r.data=n,"undefined"!=typeof FormData&&n instanceof FormData?(r.contentType=!1,r.processData=!1):"object"==typeof n&&(r.data=JSON.stringify(n));var i=o.defer();return a.request(r).fail(function(e){g.log&&g.log("error","Appstax Error: "+e.message),i.reject(e)}).then(function(e){if("undefined"!=typeof e.request){var t=e.request.getResponseHeader("x-appstax-urltoken");"string"==typeof t&&(j=t)}i.resolve(e.response)}),i.promise}function f(){function e(e){e["x-appstax-appkey"]=g.appKey}function t(e){p()&&(e["x-appstax-sessionid"]=h())}function n(e){var t=["x-appstax-x",p()?"u":"n",g.appKeyBase32].join("");e[t]=t}function r(e){e["x-appstax-urltoken"]="_"}var o={};return e(o),t(o),n(o),r(o),o}function p(){var e=h();return null!==e&&void 0!==e}function d(e){switch(typeof e){case"string":case"object":b=e;break;case"function":x=e}}function h(){return x()}function y(){return v||(v=s(w)),v}function m(){return"undefined"!=typeof FormData?new FormData:null}var v,g={},b=null,x=function(){return b},j="";t();var w={request:l,url:u,formData:m,sessionId:function(e){return d(e),h()},urlToken:function(e){return j=arguments.length>0?e:j},appKey:function(){return g.appKey},baseUrl:function(){return g.baseUrl},socket:y};return w}var r=e("extend"),o=e("kew"),i=e("./encoding"),s=e("./socket"),a=e("./http-browser");"object"!=typeof window&&(a=e("./http-node")),t.exports=n},{"./encoding":10,"./http-browser":14,"./socket":21,extend:1,kew:4}],8:[function(e,t){function n(e,t){function n(){e.on("open",f),e.on("error",p),e.on("message",d),h={},y=[]}function r(e,t){var n=e.split("/"),r=h[e]={type:n[0],created:!1,wildcard:-1!=e.indexOf("*"),on:function(t,n){l(e,t,n)},send:function(t){a({channel:e,command:"publish",message:t})},grant:function(t,n){o(e,"grant",[t],n)},revoke:function(t,n){o(e,"revoke",[t],n)}};switch(r.type){case"private":if(a({channel:e,command:"subscribe"}),void 0!=t){var i=t;o(e,"grant",i,["read","write"])}break;case"objects":a({channel:e,command:"subscribe",filter:t||""});break;default:a({channel:e,command:"subscribe"})}return r}function o(e,t,n,r){i(e),r.forEach(function(r){a({channel:e,command:t+"."+r,data:n})})}function i(e){var t=s(e);t.created||(t.created=!0,a({channel:e,command:"channel.create"}))}function s(e,t){return h[e]||r(e,t),h[e]}function a(t){t.id=String(m++),e.send(t)}function u(e,t,n){c(e,t).forEach(function(e){e(n)})}function c(e,t){var n=[];return n=y.filter("*"==e?function(e){return"*"==e.eventName||e.eventName==t}:function(n){return("*"==n.eventName||n.eventName==t)&&n.regexp.test(e)}),n.map(function(e){return e.fn})}function l(e,t,n){var r;r=new RegExp(e.lastIndexOf("*")==e.length-1?"^"+e.replace("*",""):"^"+e+"$"),y.push({regexp:r,eventName:t,fn:n})}function f(){u("*","open",{type:"open"})}function p(){u("*","error",{type:"error",error:new Error("Error connecting to realtime service")})}function d(e){var n={};try{n=JSON.parse(e.data)}catch(r){}if("string"==typeof n.channel&&"string"==typeof n.event){if(n.type=n.event,0==n.type.indexOf("object.")){var o=n.channel.split("/")[1];n.object=t.createObject(o,n.data)}u(n.channel,n.type,n)}}var h,y,m=0;return n(),{getChannel:s}}t.exports=n},{}],9:[function(e,t){function n(){function e(e,n){collection=t(n),i["$"+e]=collection}function t(e){var t={};return Object.keys(e).forEach(function(n){var r=e[n],o={};"string"==typeof r?o.type=r:"object"==typeof r&&"string"==typeof r.type&&(o.type=r.type),"relation"===o.type&&(o.relation=r.relation),t[n]=o}),t}function n(e){return i["$"+e]}function r(e){var t=n(e),r={};return t&&Object.keys(t).forEach(function(e){r[e]=o(t[e])}),r}function o(e){switch(e.type){case"string":return"";case"number":return 0;case"array":return[];case"file":return{sysDatatype:"file",filename:"",url:""};case"relation":return{sysDatatype:"relation",sysRelationType:e.relation,sysObjectIds:[]}}return void 0}var i={};return{defaultValues:r,get:n,collection:function(t,r){return e(t,r),n(t)}}}t.exports=n},{}],10:[function(e,t){var n=e("./nibbler"),r=n.create({dataBits:8,codeBits:6,keyString:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",pad:"-"}),o=n.create({dataBits:8,codeBits:5,keyString:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",pad:"-"});t.exports={base64:r,base32:o,base64ToBase32:function(e){return o.encode(r.decode(e))}}},{"./nibbler":17}],11:[function(e,t){t.exports={log:function(e){throw console&&console.error&&(e&&e.message?console.error("Appstax Error: "+e.message,e):console.error("Appstax Error"),e&&e.stack&&console.error(e.stack)),e}}},{}],12:[function(e,t){function n(e){function t(e){null!=e&&("string"==typeof e&&(e={appKey:e}),r=o({},h,r,e),r.log===!1&&(r.log=function(){}),n.apiClient=c({baseUrl:r.baseUrl,appKey:r.appKey,log:r.log}),n.files=a(n.apiClient),n.collections=u(),n.objects=i(n.apiClient,n.files,n.collections),n.users=s(n.apiClient,n.objects,y),n.request=l(n.apiClient),n.channels=f(n.apiClient.socket(),n.objects),n.models=p(n.objects,n.users,n.channels,n.apiClient.socket(),y),n.object=n.objects.createObject,n.status=n.objects.getObjectStatus,n.findAll=n.objects.findAll,n.find=n.objects.find,n.search=n.objects.search,n.signup=n.users.signup,n.login=n.users.login,n.logout=n.users.logout,n.currentUser=n.users.currentUser,n.collection=n.collections.collection,n.file=n.files.createFile,n.sessionId=n.apiClient.sessionId,n.channel=n.channels.getChannel,n.model=n.models.create)}var n={init:t},r={},y=d();return t(e),n}function r(e){console&&console[e]&&console[e].apply(console,Array.prototype.slice.call(arguments,1))}var o=e("extend"),i=e("./objects"),s=e("./users"),a=e("./files"),u=e("./collections"),c=e("./apiclient"),l=e("./request"),f=e("./channels"),p=e("./models"),d=e("./hub"),h={baseUrl:"https://appstax.com/api/latest/",log:r},y=n(h);t.exports=y,t.exports.app=n},{"./apiclient":7,"./channels":8,"./collections":9,"./files":13,"./hub":15,"./models":16,"./objects":18,"./request":20,"./users":22,extend:1}],13:[function(e,t){function n(e){function t(e){var t,r=Object.create({});if(e instanceof Blob){var o=e;t=n(r,{filename:o.name,nativeFile:o})}else if(f(e)){if(0==e.files.length)return void 0;var o=e.files[0];t=n(r,{filename:o.name,nativeFile:o})}else t=n(r,e),t.status="saved";if(!r||!t)throw new Error("Invalid file options");return Object.defineProperty(r,"filename",{get:function(){return t.filename},enumerable:!0}),Object.defineProperty(r,"url",{get:function(){return t.url},enumerable:!0}),Object.defineProperty(r,"preview",{value:function(){return i(t)}}),Object.defineProperty(r,"imageUrl",{value:function(e,n){return s(t,e,n)}}),Object.defineProperty(r,"internalFile",{value:t,enumerable:!1,writable:!1}),r}function n(e,t){var n={file:e,filename:t.filename,nativeFile:t.nativeFile,url:t.url||"",status:"new"};return n}function i(e){if(!e.previewPromise){var t=r.defer(),n=new FileReader;n.onload=function(n){e.url=n.target.result,t.resolve(e.file)},n.readAsDataURL(e.nativeFile),e.previewPromise=t.promise}return e.previewPromise}function s(e,t,n){var r=o({width:"-",height:"-"},n);return e.url.replace("/files/","/images/"+t+"/"+r.width+"/"+r.height+"/")}function a(t,n,o,i){var s=r.defer(),a=i.internalFile;a.status="saving";var c=u(t,n,o,i.filename),l=new FormData;return l.append("file",a.nativeFile),e.request("put",c,l).then(function(){a.status="saved",a.url=c,s.resolve(i)}),s.promise}function u(t,n,r,o){if(!o)return"";var i="token",s=e.urlToken();return s.length<2&&(i="appkey",s=e.appKey()),e.url("/files/:collectionName/:objectId/:propertyName/:filename?:tokenKey=:tokenValue",{collectionName:t,objectId:n,propertyName:r,filename:o,tokenKey:i,tokenValue:s})}function c(e){var t=null,n=e.internalFile;return null!=n&&(t=n.nativeFile),t}function l(e){return null!=e&&void 0!=e&&null!=e.internalFile}function f(e){return"undefined"!=typeof e&&"INPUT"==e.nodeName&&"file"==e.type}function p(e,t){return"string"==typeof t&&(e.internalFile.status=t),e.internalFile.status}function d(e,t){var n=e.internalFile;n&&(n.url=t)}return{create:t,isFile:l,saveFile:a,status:p,setUrl:d,urlForFile:u,nativeFile:c,createFile:t}}var r=e("kew"),o=e("extend");t.exports=n},{extend:1,kew:4}],14:[function(e,t){function n(e){try{var t=JSON.parse(e.responseText);return"string"==typeof t.errorMessage?new Error(t.errorMessage):t}catch(n){}return e.responseText}var r=e("extend"),o=e("kew"),i=null;"object"==typeof window&&(i=e("reqwest")),t.exports={request:function(e){var t=o.defer(),s=i(r({type:"json",contentType:"application/json",crossOrigin:!0},e)).then(function(e){t.resolve({response:e,request:s.request})}).fail(function(e){t.reject(n(e))});return t.promise}}},{extend:1,kew:4,reqwest:5}],15:[function(e,t){function n(){function e(e,t){n.push({type:e,handler:t})}function t(e,t){var o=r({},t,{type:e});n.forEach(function(t){t.type==e&&t.handler(o)})}var n=[];return{on:e,pub:t}}var r=e("extend");t.exports=n},{extend:1}],16:[function(e,t){function n(e,t,n,o,i){return{create:function(){return r(e,t,n,o,i)}}}function r(e,t,n,r,a){function u(u,c){c=c||{};var l;l="currentUser"==u?i(v,e,t,n,a):"status"==u?s(v,r):o(u,c,v,e,n),d.push(l),l.load(),l.connect()}function c(e,t){h.push({event:e,handler:t})}function l(e,t){h.forEach(function(n){n.event==e&&n.handler(t)})}function f(e){if(!e)return e;var t=e.id;return y[t]||(y[t]=e),y[t]}function p(t){var n=y[t.id];n?e.copy(t,n):y[t.id]=t,d.forEach(function(e){e.sort&&e.sort()}),l("change")}var d=[],h=[],y={},m={watch:u,on:c},v={root:m,normalize:f,notifyHandlers:l,updateObject:p};return m}function o(e,t,n,r,o){function i(e){e=e.map(n.normalize),d(e),n.root[h.name]=e,l(),n.notifyHandlers("change")}function s(){return n.root[h.name]}function a(e){e=n.normalize(e),s().push(e),h.sort(),n.notifyHandlers("change")}function u(e){s().splice(c(e),1),n.notifyHandlers("change")}function c(e){var t=-1;return s().some(function(n,r){return n.id==e.id?(t=r,!0):!1}),t}function l(){r.sort(s(),h.order)}function f(){r.findAll(h.collection).then(i)}function p(){var e=o.getChannel("objects/"+h.collection);e.on("object.created",function(e){a(e.object)}),e.on("object.deleted",function(e){u(e.object)}),e.on("object.updated",function(e){n.updateObject(e.object)})}function d(e){function t(t,n){var r=e.filter(function(e){var r=[].concat(n),o=[].concat(e[t]);return r.some(function(e){return o.some(function(t){return(e.id||e)==(t.id||t)})})});return d(r),r}e.has=t}var h={};return h.name=e,h.collection=e,h.order=t.order||"-created",h.sort=l,h.load=f,h.connect=p,i([]),h}function i(e,t,n,r,o){function i(){s(null),o.on("users.login",function(e){s(e.user)}),o.on("users.signup",function(e){s(e.user)}),o.on("users.logout",function(){s(null)})}function s(t){t=e.normalize(t),e.root[c.name]=t}function a(){var e=n.currentUser();e&&e.refresh().then(s)}function u(){var t=r.getChannel("objects/users");t.on("object.updated",function(t){e.updateObject(t.object)})}var c={};return c.name="currentUser",c.load=a,c.connect=u,i(),c}function s(e,t){function n(){r(t.status()),t.on("status",function(){r(t.status())})}function r(t){e.root[s.name]=t,e.notifyHandlers("change")}function o(){}function i(){}var s={};return s.name="status",s.load=o,s.connect=i,n(),s}t.exports=n},{}],17:[function(e,t){t.exports={create:function(e){return new n(e)}};var n=function(e){"use strict";var t,n,r,o,i,s,a,u,c,l,f,p,d;t=function(){var t,f,p;for(n=e.pad||"",r=e.dataBits,o=e.codeBits,i=e.keyString,s=e.arrayData,f=Math.max(r,o),p=0,a=[],t=0;f>t;t+=1)a.push(p),p+=p+1;c=p,u=r/l(r,o)},l=function(e,t){for(var n;0!==t;)n=t,t=e%t,e=n;return e},f=function(e,t,r,o){var l,f,p,d,h,y,m,v;for(v=function(e){m.push(o?s?e:String.fromCharCode(e):i.charAt(e))},h=0,y=0,m=[],f=e.length,l=0;f>l;l+=1){if(y+=t,o){if(p=e.charAt(l),d=i.indexOf(p),p===n)break;if(0>d)throw'the character "'+p+'" is not a member of '+i}else if(d=s?e[l]:e.charCodeAt(l),(d|c)!==c)throw d+" is outside the range 0-"+c;for(h=h<<t|d;y>=r;)y-=r,v(h>>y),h&=a[y]}if(!o&&y>0)for(v(h<<r-y);m.length%u>0;)m.push(n);return s&&o?m:m.join("")},p=function(e){return f(e,r,o,!1)},d=function(e){return f(e,o,r,!0)},this.encode=p,this.decode=d,t()}},{}],18:[function(e,t){function n(e,t,n){function c(e,t,o){var i=p(e),s=Object.create(Z);return Object.defineProperty(s,"id",{get:function(){return i.id},enumerable:!0}),Object.defineProperty(s,"internalId",{writable:!1,value:i.internalId,enumerable:!0}),Object.defineProperty(s,"internalObject",{writable:!1,value:i,enumerable:!1}),Object.defineProperty(s,"collectionName",{get:function(){return i.collectionName},enumerable:!0}),Object.defineProperty(s,"created",{get:function(){return new Date(i.sysValues.sysCreated)},enumerable:!0}),Object.defineProperty(s,"updated",{get:function(){return new Date(i.sysValues.sysUpdated)},enumerable:!0}),Object.defineProperty(s,"permissions",{get:function(){return i.sysValues.sysPermissions},enumerable:!0}),"users"==e&&Object.defineProperty(s,"username",{get:function(){return i.sysValues.sysUsername},enumerable:!0}),t=r({},n.defaultValues(e),t),l(s,t,o||c),null!==s.id&&(i.status="saved"),s}function l(e,t,n){var o=e.internalObject,i={};if("object"==typeof t){var s=o.sysValues;o.setId(t.sysObjectId),Object.keys(t).forEach(function(r){var a=t[r];0===r.indexOf("sys")?s[r]=a:"string"==typeof a.sysDatatype?(i[r]=f(r,a,e,n),"relation"==a.sysDatatype&&(o.relations[r]={type:a.sysRelationType,ids:(a.sysObjects||[]).map(function(e){return e.sysObjectId||e
})})):i[r]=a})}r(e,i)}function f(e,n,r,o){function i(e,t){var n=[];return"undefined"!=typeof e.sysObjects&&(n=e.sysObjects.map(function(n){return"string"==typeof n?n:t(e.sysCollection,n,t)})),"single"===e.sysRelationType?n[0]:n}switch(n.sysDatatype){case"relation":return i(n,o);case"file":return t.create({filename:n.filename,url:t.urlForFile(r.collectionName,r.id,e,n.filename)})}return null}function p(e){var t={id:null,internalId:T(),collectionName:e,sysValues:{},initialValues:{},created:new Date,updated:new Date,status:"new",grants:[],revokes:[],relations:{},setId:function(e){e&&(this.id=e)},resetPermissions:function(){this.grants=[],this.revokes=[]}};return t}function d(e){var t=s.defer(),n=e.internalObject;return"new"===n.status?t.resolve(e):H(e.collectionName,e.id).then(function(n){Object.keys(n).filter(function(e){return-1==a.indexOf(e)}).forEach(function(t){e[t]=n[t]}),t.resolve(e)}),t.promise}function h(t,n){var r=t.internalObject,n="object"==typeof n?n:s.defer();if("saving"===r.status)return setTimeout(function(){h(t,n)},100),n.promise;var o,i,a,u;return null==t.id?(o=e.url("/objects/:collection",{collection:t.collectionName}),i="post",u=E(t),a=S(t)):(o=e.url("/objects/:collection/:id",{collection:t.collectionName,id:t.id}),i="put",a=S(t)),r.status="saving",e.request(i,o,u||a).then(function(e){r.setId(e.sysObjectId),r.status="saved",k(t,a),"undefined"!=typeof FormData&&u instanceof FormData&&v(t),n.resolve(t)}).fail(function(e){r.status="error",n.reject(e)}),n.promise}function y(t){var n=s.defer(),r=e.url("/objects/:collection/:id",{collection:t.collectionName,id:t.id});return e.request("DELETE",r).then(function(){n.resolve()}).fail(function(e){n.reject(e)}),n.promise}function m(e,t){if(B(e))throw new Error("Error calling expand() on unsaved object.");var n=s.defer(),r=1;return"number"==typeof t&&(r=t),H(e.collectionName,e.id,{expand:r}).then(function(t){var r=e.internalObject,o=Object.keys(r.relations);o.forEach(function(n){e[n]=t[n]}),n.resolve(e)}),n.promise}function v(e){var n=P(e);return Object.keys(n).map(function(r){var o=n[r],i=t.urlForFile(e.collectionName,e.id,r,o.filename);t.status(o,"saved"),t.setUrl(o,i)})}function g(e){var n=P(e),r=Object.keys(n),o=[];return r.forEach(function(r){var i=n[r];if("saved"!==t.status(i)){var s=t.saveFile(e.collectionName,e.id,r,i);o.push(s)}}),s.all(o).then(function(){return s.resolve(e)})}function b(t){function n(e){return{sysObjectId:t.id,username:e.username,permissions:e.permissions}}var r=s.defer(),o=e.url("/permissions"),i=t.internalObject,a=i.grants.map(n),u=i.revokes.map(n);if(i.resetPermissions(),a.length+u.length===0)r.resolve(t);else{var c={grants:a,revokes:u};e.request("POST",o,c).then(function(){r.resolve(t)}).fail(function(e){r.reject(e)})}return r.promise}function x(e){q(e);var t=_(e);if(t.some(B))throw new Error("Error saving object. Found unsaved related objects. Save related objects first or consider using saveAll().");return s.resolve(e)}function j(e){function t(){return s.all(i.map(h))}function n(){return s.all(a.map(h))}function r(){return s.all(u.map(h))}var o=w(e),i=o.inbound.filter(B),a=o.outbound,u=o.inbound.filter(function(e){return!B(e)});return 0==a.length+i.length+u.length?e.save():t().then(n).then(r)}function w(e){function t(e){return Object.keys(e).map(n)}function n(e){return o[e]}for(var r=[e],o={},i={},s={};r.length>0;){var a=r.shift();if(q(a),null==o[a.internalId]){o[a.internalId]=a;var u=_(a).filter(function(e){return"object"==typeof e});u.forEach(function(e){i[e.internalId]=e}),u.length>0&&(s[a.internalId]=a,r=r.concat(u))}}return{all:t(o),inbound:t(i),outbound:t(s)}}function _(e){var t=[],n=e.internalObject;return Object.keys(n.relations).forEach(function(n){var r=e[n];null!=r&&(t=t.concat(r))}),t}function O(e,t){var n=e.internalObject,r=n.relations[t],o={additions:[],removals:[]};if(r){var i=e[t],s=[];i&&(s="array"==r.type?i:[i]);var a=s.map(function(e){return e.id||e}).filter(function(e){return"string"==typeof e});o.additions=a.filter(function(e){return null!=e&&-1==r.ids.indexOf(e)}),o.removals=r.ids.filter(function(e){return null!=e&&-1==a.indexOf(e)})}return o}function k(e,t){var n=e.internalObject;Object.keys(n.relations).forEach(function(e){var r=n.relations[e],o=t[e].sysRelationChanges;r.ids=r.ids.concat(o.additions).filter(function(e){return-1==o.removals.indexOf(e)})})}function q(e){var t=(n.get(e.collectionName),e.internalObject.relations),r=A(e);Object.keys(r).forEach(function(e){if(!t[e]){var n=r[e],o="";null!==n&&"object"==typeof n&&("undefined"==typeof n.length?"string"==typeof n.collectionName&&(o="single"):n.some(function(e){return"string"==typeof e.collectionName?(o="array",!0):!1})),""!==o&&(t[e]={type:o,ids:[]})}})}function C(e){var t=Object.keys(e);return t.filter(function(e){return-1==a.indexOf(e)})}function A(e){if(!K(e))return{};var t={};C(e).forEach(function(n){/^[a-zA-Z]/.test(n)&&(t[n]=e[n])});var n=e.internalObject.sysValues;return Object.keys(n).forEach(function(e){-1==a.indexOf(e)&&(t[e]=n[e])}),t}function E(n){var r=S(n),o=P(n),i=!1,s=e.formData();return Object.keys(o).forEach(function(e){var n=o[e],r=t.nativeFile(n);r&&"saved"!==t.status(n)&&(i=!0,s.append(e,r))}),i?(s.append("sysObjectData",JSON.stringify(r)),s):r}function S(e){var n=e.internalObject,r=A(e);return Object.keys(r).forEach(function(o){var i=r[o];t.isFile(i)?r[o]={sysDatatype:"file",filename:i.filename}:"object"==typeof n.relations[o]&&(r[o]={sysRelationChanges:O(e,o)})}),r}function P(e){var n=A(e),r={};return Object.keys(n).forEach(function(e){var o=n[e];t.isFile(o)&&(r[e]=o)}),r}function T(){var e="internal-id-"+W+"-"+Q;return Q++,e}function F(e){if(e){var t={};return"number"==typeof e.expand?t.expanddepth=e.expand:e.expand===!0&&(t.expanddepth=1),t}}function I(t,n){var r=e.url("/objects/:collection",{collection:t},F(n));return M(r,t,n)}function R(e){if(!(arguments.length<2)){var t=arguments[1],n=arguments[2];return"string"==typeof t&&-1==t.indexOf("=")?H(e,t,n):"string"==typeof t?N(e,t,n):"object"==typeof t&&"function"==typeof t.queryString?D(e,t,n):"object"==typeof t?V(e,t,n):"function"==typeof t?U(e,t,n):void 0}}function H(t,n,r){var o=e.url("/objects/:collection/:id",{collection:t,id:n},F(r));return M(o,t,r)}function N(t,n,r){var o=e.url("/objects/:collection?filter=:queryString",{collection:t,queryString:n},F(r));return M(o,t,r)}function D(e,t,n){return N(e,t.queryString(),n)}function U(e,t,n){var r=z();return t(r),N(e,r.queryString(),n)}function V(e,t,n){return U(e,function(e){Object.keys(t).forEach(function(n){var r=t[n];"object"==typeof r&&"string"==typeof r.id?e.relation(n).has(r):e.string(n).equals(r)})},n)}function L(e){var t=arguments[1],n=arguments[2];if(arguments.length>=3&&"string"==typeof arguments[1]){t={};var r=arguments[1];Array.prototype.forEach.call(arguments[2],function(e){t[e]=r}),4==arguments.length&&(n=arguments[3])}return R(e,function(e){e.operator("or"),Object.keys(t).forEach(function(n){var r=t[n];e.string(n).contains(r)})},n)}function M(t,n,r){var o=r&&r.factory||c,i=s.defer();return e.request("get",t).then(function(e){if(Array.isArray(e.objects)){var t=e.objects.map(function(e){return o(n,e,o)});i.resolve(t)}else i.resolve(o(n,e,o))}).fail(function(e){i.reject(e)}),i.promise}function z(e){return o(e)}function X(e){var t=e.internalObject;return t?t.status:void 0}function B(e){return"new"===X(e)}function K(e){return void 0!==e&&null!==e}function J(e,t){null!=e&&null!=t&&(Object.keys(e).filter(function(e){return-1==a.indexOf(e)}).forEach(function(n){t[n]=e[n]}),Object.keys(e.internalObject.sysValues).forEach(function(n){t.internalObject.sysValues[n]=e.internalObject.sysValues[n]}))}function $(e,t){t=t||"";var n=1,r=t;0==t.indexOf("-")&&(n=-1,r=t.substr(1)),"function"==typeof e.sort&&e.sort(function(e,t){var o=e[r],i=t[r];return"undefined"==typeof o&&(o=0),"undefined"==typeof i&&(i=0),o.getTime&&(o=o.getTime()),i.getTime&&(i=i.getTime()),o>i?n:i>o?-n:0})}var W=u++,Q=0,Z={save:function(){return x(this).then(h).then(b).then(g).fail(i.log)},saveAll:function(){return j(this).fail(i.log)},remove:function(){return y(this).fail(i.log)},refresh:function(){return d(this).fail(i.log)},expand:function(e){return m(this,e).fail(i.log)},grant:function(e,t){"string"==typeof e&&(e=[e]);var n=this.internalObject;e.forEach(function(e){n.grants.push({username:e,permissions:t})})},revoke:function(e,t){"string"==typeof e&&(e=[e]);var n=this.internalObject;e.forEach(function(e){n.revokes.push({username:e,permissions:t})})},grantPublic:function(e){this.grant("*",e)},revokePublic:function(e){this.revoke("*",e)},hasPermission:function(e){return-1!=this.permissions.indexOf(e)}};return{create:c,createQuery:z,getProperties:A,createObject:c,getObjectStatus:X,findAll:I,find:R,search:L,sort:$,copy:J}}var r=e("extend"),o=e("./query"),i=e("./faillogger"),s=e("kew");t.exports=n;var a=["collectionName","id","internalId","username","created","updated","permissions","save","saveAll","remove","grant","revoke","sysCreated","sysUpdated","sysPermissions"],u=0},{"./faillogger":11,"./query":19,extend:1,kew:4}],19:[function(e,t){t.exports=function(e){function t(){"string"==typeof e&&n(e)}function n(e){u.push(e)}function r(e){return{equals:function(t){n(s("$='$'",e,t))},contains:function(t){n(s("$ like '%$%'",e,t))}}}function o(e){function t(e){return[].concat(e).map(function(e){return"'"+(e.id||e)+"'"})}return{has:function(r){var o=t(r);n(s("$ has ($)",e,o.join(",")))}}}function i(){return u.join(s(" $ ",a))}function s(e){var t=Array.prototype.slice.call(arguments,1),n=e;return t.forEach(function(e){n=n.replace("$",e)}),n}var a="and",u=[];return t(),{queryString:i,string:r,relation:o,operator:function(e){a=e}}}},{}],20:[function(e,t){function n(e){function t(t,n,r){return n=e.url("/server"+n),e.request(t,n,r)}return t}t.exports=n},{}],21:[function(e,t){function n(e){function t(e){"object"==typeof e&&(e=JSON.stringify(e)),x&&1==x.readyState?(n(),x.send(e)):(v.push(e),a())}function n(){for(;v.length>0;){if(!x||1!=x.readyState){a();break}var e=v.shift();x.send(e)}}function i(e,t){_[e].push(t)}function s(){clearInterval(j),x&&x.close(),g=null}function a(){g||u(),j||(j=setInterval(function(){(!x||x.readyState>1)&&(m("connecting"),g.then(c))},100))}function u(){m("connecting");var t=r.defer();g=t.promise;var n=e.url("/messaging/realtime/sessions",{},{unique:(Math.random()*Date.now()).toString(16)});return e.request("post",n).then(function(e){b=e.realtimeSessionId,t.resolve()}).fail(function(e){y("error",{error:e})}),g}function c(){var t=e.url("/messaging/realtime",{},{rsession:b});t=t.replace("http","ws"),x=l(t),x.onopen=f,x.onerror=p,x.onmessage=d,x.onclose=h}function l(e){return"undefined"!=typeof WebSocket?new WebSocket(e):"undefined"!=typeof o?new o(e):void 0}function f(e){y("open",e),m("connected"),n()}function p(e){y("error",e)}function d(e){y("message",e)}function h(e){y("close",e),m("disconnected")}function y(e,t){_[e].forEach(function(e){e(t)})}function m(e){var t=w;w=e,e!=t&&y("status",{type:"status",status:w})}var v=[],g=null,b="",x=null,j=null,w="disconnected",_={open:[],message:[],error:[],close:[],status:[]};return{connect:a,disconnect:s,status:function(){return w},send:t,on:i}}var r=e("kew"),o=e("ws");t.exports=n},{kew:4,ws:6}],22:[function(e,t){function n(e,t,n){function i(){p()}function s(e,n){var o=r({},n,{sysUsername:e}),i=t.create("users",o);return i}function a(t,i,a,u){var l=o.defer(),f={},p=!0;"boolean"==typeof a&&(p=a),"object"==typeof a?f=a:"object"==typeof u&&(f=u);var h=e.url("/users",{},{login:p}),y=r({sysUsername:t,sysPassword:i},f);return e.request("post",h,y).then(function(e){var r=s(t,e.user);p&&(r=c(t,e)),l.resolve(r),n.pub("users.signup",{user:d})}).fail(function(e){l.reject(e)}),l.promise}function u(t,r){var i=o.defer(),s=e.url("/sessions");return e.request("post",s,{sysUsername:t,sysPassword:r}).then(function(e){c(t,e),i.resolve(d),n.pub("users.login",{user:d})}).fail(function(e){i.reject(e)}),i.promise}function c(e,t){var n=t.user?t.user.sysObjectId:null;return f(t.sysSessionId,e,n),d=s(e,t.user)}function l(){d=null,e.sessionId(null),"undefined"!=typeof localStorage&&localStorage.removeItem("appstax_session_"+e.appKey()),n.pub("users.logout")}function f(t,n,r){e.sessionId(t),"undefined"!=typeof localStorage&&localStorage.setItem("appstax_session_"+e.appKey(),JSON.stringify({username:n,sessionId:t,userId:r}))}function p(){if("undefined"!=typeof localStorage){var t=localStorage.getItem("appstax_session_"+e.appKey());if(t){var n=JSON.parse(t);e.sessionId(n.sessionId),d=s(n.username,{sysObjectId:n.userId})}}}var d=null;return i(),{restoreSession:p,signup:a,login:u,logout:l,currentUser:function(){return d}}}var r=e("extend"),o=e("kew");t.exports=n},{extend:1,kew:4}]},{},[12])(12)});